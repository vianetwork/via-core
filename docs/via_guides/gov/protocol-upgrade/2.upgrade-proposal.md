# How to create an upgrade proposal

Creating a proposal can be done by any **P2PKH** wallet. The process should inscribe the data using the btc client inscriber
**ProtocolUpgradeProposal** inscription.

1. Make sure you are in the last code version in main branch.
2. Create a new upgrade config

```sh
    cd contracts && yarn sc build && cd .. && \
    cd infrastructure/via-protocol-upgrade && \
    yarn start upgrades create via-network --protocol-version <new-version>.
```

3. Publish the new system contracts

```sh
yarn start system-contracts publish \
    --private-key <l2-private-key> \
    --l2rpc http://0.0.0.0:3050 \
    --environment <mainnet | testnet | devnet> \
    --new-protocol-version <new-version> \
    --recursion-scheduler-level-vk-hash <hash> \
    --bootloader \
    --default-aa \
    --system-contracts
```

4. The previous cmd created a new upgrade file at this location `etc/upgrades/1742370950-via-network` with the new
   system contracts we are going to deploy.
5. When all the **l1_batches** are processed execute the next cmd to create an upgrade proposal.

```sh
yarn start l2-transaction upgrade-system-contracts \
    --private-key <l1-private-key> \
    --environment <mainnet | testnet | devnet> \
    --network <network> \
    --rpc-url <rpcUrl> \
    --rpc-username <rpcUsername> \
    --rpc-password <rpcPassword>
```
